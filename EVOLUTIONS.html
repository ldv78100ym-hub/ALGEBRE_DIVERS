<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercices sur les √©volutions</title>
    <script>
        window.MathJax = {
            loader: { load: ['input/tex', 'output/chtml'] },
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true,
                packages: {'[+]': ['ams']}
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.startup.promise.then(() => {
                        console.log('MathJax charg√©');
                    });
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        h2, h3 {
            color: #007BFF;
            border-bottom: 2px solid #007BFF;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        .cours {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #007BFF;
            border-radius: 8px;
            background-color: #e6f0ff;
        }
        .exercice {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .exercice-section {
            padding: 10px;
            margin-top: 15px;
            border: 1px dashed #007BFF;
            border-radius: 5px;
        }
        button {
            background-color: #007BFF;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-bottom: 5px;
            white-space: nowrap; /* Emp√™che les noms de boutons de se casser */
        }
        button:hover {
            background-color: #0056b3;
        }
        .boutons-exercice {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        /* Style pour les groupes de boutons sp√©cifiques dans les sections du cours */
        .boutons-specifiques { 
            display: flex;
            flex-wrap: wrap; 
            gap: 8px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .reponse {
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            display: none;
        }
        .correction {
            margin-top: 10px;
            padding: 15px;
            background-color: #d4edda;
            border-radius: 5px;
            display: none;
        }
        .bouton-reponse {
            background-color: #28a745;
        }
        .bouton-reponse:hover {
            background-color: #218838;
        }
        .bouton-correction {
            background-color: #dc3545;
        }
        .bouton-correction:hover {
            background-color: #c82333;
        }
        /* STYLES POUR BOUTONS PRINCIPAUX ET COURS */
        .boutons-principaux {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        #afficher-droits {
            background-color: #6c757d; 
        }
        #afficher-droits:hover {
            background-color: #5a6268;
        }
        #afficher-cours {
            background-color: #ffc107; 
            color: #333;
        }
        #afficher-cours:hover {
            background-color: #e0a800;
        }
        #generer-aleatoire {
            background-color: #007BFF;
            color: white;
        }
        #generer-aleatoire:hover {
            background-color: #0056b3;
        }
         /* Style pour le nouveau bouton Autres chapitres (lien) */
        #autres-chapitres {
            background-color: #ff6600; /* Orange vif */
            text-decoration: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
            display: inline-block;
            margin-bottom: 5px;
            white-space: nowrap;
            line-height: normal; 
        }
        #autres-chapitres:hover {
            background-color: #cc5200; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Exercices sur les √©volutions</h1>
        <div class="boutons-principaux">
            <button id="generer-aleatoire">G√©n√©rer un nouvel exercice al√©atoire</button>
            <button id="afficher-cours">Masquer le cours & Exercices</button>
            <a href="https://ldv78100ym-hub.github.io/HOME/" target="_blank" id="autres-chapitres">Autres chapitres</a>
            <button id="afficher-droits">Droits d'auteur</button>
        </div>
        
        <div id="cours" class="cours" style="display: block;">
            <h2>üìà Cours : √âvolutions et Taux d'√âvolution</h2>
            
            <h3>1. Taux d'√âvolution et Coefficient Multiplicateur</h3>
            
            <p>Le <strong>taux d'√©volution</strong> (ou taux de variation) permet de mesurer le changement entre une valeur de d√©part \(V_D\) et une valeur d'arriv√©e \(V_A\). Il est g√©n√©ralement exprim√© en pourcentage.</p>
            \[
            t = \dfrac{V_A - V_D}{V_D}
            \]
            
            <p>Le <strong>coefficient multiplicateur</strong> \(C\) est le facteur par lequel il faut multiplier \(V_D\) pour obtenir \(V_A\). Il est directement li√© au taux \(t\) :</p>
            \[
            C = 1 + t = 1 + \dfrac{p}{100} \qquad (\text{o√π } p \text{ est le taux en pourcentage})
            \]
            <p>Ainsi, on a : \(V_A = V_D \times C\).</p>
            
            <ul>
                <li>Si \(t > 0\) (ou \(C > 1\)), c'est une <strong>augmentation</strong>.</li>
                <li>Si \(t < 0\) (ou \(C < 1\)), c'est une <strong>diminution</strong>.</li>
            </ul>

            <div class="exercice-section">
                <h4>Exercices sur l'√©volution simple :</h4>
                <div class="boutons-specifiques"> <button onclick="genererExercicePart1(1)">Chercher \(V_A\) (Valeur d'Arriv√©e)</button>
                    <button onclick="genererExercicePart1(2)">Chercher \(V_D\) (Valeur de D√©part)</button>
                    <button onclick="genererExercicePart1(3)">Chercher \(t\) (Taux d'√©volution)</button>
                </div>
                <div id="exercices-part1"></div>
            </div>

            <h3>2. √âvolutions Successives</h3>
            
            <p>Si une valeur subit plusieurs √©volutions successives (de coefficients multiplicateurs \(C_1, C_2, C_3, ...\)), le <strong>coefficient multiplicateur global</strong> \(C_{global}\) est le produit des coefficients individuels :</p>
            \[
            C_{global} = C_1 \times C_2 \times C_3 \times ...
            \]
            
            <p>La valeur d'arriv√©e \(V_A\) est donn√©e par :</p>
            \[
            V_A = V_D \times C_{global}
            \]
            
            <p>Le <strong>taux d'√©volution global</strong> \(t_{global}\) est ensuite calcul√© √† partir de \(C_{global}\) :</p>
            \[
            t_{global} = C_{global} - 1
            \]
            
            <div class="exercice-section">
                <h4>Exercices sur les √©volutions successives :</h4>
                 <div class="boutons-specifiques"> <button onclick="genererExercicePart2(1)">Chercher \(V_A\)</button>
                    <button onclick="genererExercicePart2(2)">Chercher \(V_D\)</button>
                    <button onclick="genererExercicePart2(3)">Chercher \(t_{global}\)</button>
                    <button onclick="genererExercicePart2(4)">Chercher un taux individuel</button>
                </div>
                <div id="exercices-part2"></div>
            </div>

            <h3>3. Taux d'√âvolution Moyen</h3>
            
            <p>Le <strong>taux d'√©volution annuel moyen</strong> \(t_{moyen}\) est le taux unique qui, appliqu√© \(n\) fois de suite, produit le m√™me effet que l'ensemble des \(n\) √©volutions successives. Il est calcul√© √† partir du coefficient multiplicateur global \(C_{global}\) :</p>
            
            <h4>a) Coefficient multiplicateur moyen \(C_{moyen}\) :</h4>
            \[
            C_{moyen} = (C_{global})^{\dfrac{1}{n}}
            \]
            
            <h4>b) Taux moyen \(t_{moyen}\) :</h4>
            \[
            t_{moyen} = C_{moyen} - 1
            \]
            <p>O√π \(n\) est le nombre total d'√©volutions.</p>

            <div class="exercice-section">
                <h4>Exercices sur le taux moyen :</h4>
                <div class="boutons-specifiques"> <button onclick="genererExercicePart3(1)">Chercher \(V_A\)</button>
                    <button onclick="genererExercicePart3(2)">Chercher \(V_D\)</button>
                    <button onclick="genererExercicePart3(3)">Calculer \(t_{moyen}\)</button>
                    <button onclick="genererExercicePart3(4)">Chercher \(n\) (p√©riodes)</button>
                    <button onclick="genererExercicePart3(5)">Chercher \(V_k\) (Valeur Interm√©diaire)</button>
                </div>
                <div id="exercices-part3"></div>
            </div>

        </div>
        
        <div id="droits-auteur" class="correction" style="display: none;">
            <h3>‚öñÔ∏è Droits d'Auteur et Licence d'Utilisation</h3>
            <p><strong>Auteur :</strong> Yann Merdy (yann.merdy@gmail.com) - Novembre 2025</p>
            <p><strong>Licence d'Utilisation Non Commerciale</strong></p>
            <p>Ce code HTML/CSS/JavaScript ainsi que le contenu g√©n√©r√© par l'application ("Cours et Exercices Dynamiques : Les √âvolutions") sont la propri√©t√© intellectuelle exclusive de l'auteur, Yann Merdy.</p>
            
            <h4>Conditions :</h4>
            <ul>
                <li><strong>Utilisation Priv√©e et √âducative (Autoris√©e) :</strong> Vous √™tes autoris√©.e √† utiliser, copier, modifier et distribuer ce code et son contenu uniquement √† des fins personnelles, √©ducatives et non lucratives.</li>
                <li><strong>Utilisation Commerciale (Interdite) :</strong> Toute utilisation, distribution, int√©gration ou reproduction du code ou du contenu (total ou partiel) √† des fins commerciales, lucratives ou professionnelles est strictement interdite sans un accord √©crit pr√©alable et explicite de l'auteur.</li>
                <li><strong>Attribution :</strong> Toute reproduction ou modification doit conserver la mention de l'auteur originale (Yann Merdy) et la pr√©sente notice de droits d'auteur.</li>
            </ul>
            <p>Pour toute demande d'utilisation commerciale ou de licence sp√©cifique, veuillez contacter l'auteur √† l'adresse indiqu√©e ci-dessus.</p>
        </div>
        
        <div id="exercices-generaux">
            <h3 id="titre-general" style="display: none;">Exercices Al√©atoires</h3>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('generer-aleatoire').addEventListener('click', genererExerciceAleatoire);
            document.getElementById('afficher-droits').addEventListener('click', afficherDroitsAuteur);
            document.getElementById('afficher-cours').addEventListener('click', afficherCours);
            
            // Le cours est affich√© par d√©faut, on met √† jour le texte du bouton.
            document.getElementById('afficher-cours').textContent = 'Masquer le cours & Exercices';

            // MathJax doit √™tre lanc√© au chargement pour afficher le cours.
            const coursDiv = document.getElementById('cours');
            if (coursDiv.style.display === 'block') {
                MathJax.typesetPromise([coursDiv]);
            }
        });

        // --- Fonctions utilitaires ---
        function arrondir(valeur, decimales) {
            return Number(Math.round(valeur + 'e' + decimales) + 'e-' + decimales);
        }

        function getRandomArbitrary(min, max) {
            return Math.random() * (max - min) + min;
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function afficherDroitsAuteur() {
            const droitsDiv = document.getElementById('droits-auteur');
            droitsDiv.style.display = (droitsDiv.style.display === 'block') ? 'none' : 'block';
            if (droitsDiv.style.display === 'block') {
                document.getElementById('cours').style.display = 'none'; 
                MathJax.typesetPromise([droitsDiv]);
            }
        }
        
        function afficherCours() {
            const coursDiv = document.getElementById('cours');
            coursDiv.style.display = (coursDiv.style.display === 'block') ? 'none' : 'block';
            
            const coursButton = document.getElementById('afficher-cours');
            if (coursDiv.style.display === 'block') {
                document.getElementById('droits-auteur').style.display = 'none'; 
                MathJax.typesetPromise([coursDiv]);
                coursButton.textContent = 'Masquer le cours & Exercices'; 
            } else {
                coursButton.textContent = 'Afficher le cours & Exercices'; 
            }
        }
        
        // --- Fonction de cr√©ation/affichage de l'exercice ---
        function creerExercice(targetDivId, enonce, reponse, correction) {
            const targetDiv = document.getElementById(targetDivId);
            const exerciceDiv = document.createElement('div');
            exerciceDiv.className = 'exercice';
            exerciceDiv.innerHTML = `
                <p>${enonce}</p>
                <div class="boutons-exercice">
                    <button class="bouton-reponse">Voir la r√©ponse</button>
                    <button class="bouton-correction">Voir la correction d√©taill√©e</button>
                </div>
                <div class="reponse">${reponse}</div>
                <div class="correction">${correction}</div>
            `;
            
            // Remplace l'exercice pr√©c√©dent si ce n'est pas la div g√©n√©rale
            if (targetDivId !== 'exercices-generaux') {
                targetDiv.innerHTML = '';
            }
            targetDiv.appendChild(exerciceDiv);

            const reponseBouton = exerciceDiv.querySelector('.bouton-reponse');
            const correctionBouton = exerciceDiv.querySelector('.bouton-correction');

            reponseBouton.addEventListener('click', function() {
                const reponseDiv = this.parentNode.nextElementSibling;
                reponseDiv.style.display = 'block';
                MathJax.typesetPromise([reponseDiv]);
            });

            correctionBouton.addEventListener('click', function() {
                const correctionDiv = this.parentNode.nextElementSibling.nextElementSibling;
                correctionDiv.style.display = 'block';
                MathJax.typesetPromise([correctionDiv]);
            });

            MathJax.typesetPromise([exerciceDiv]);

            // Affiche le titre g√©n√©ral si un exercice y est g√©n√©r√©
            if (targetDivId === 'exercices-generaux') {
                document.getElementById('titre-general').style.display = 'block';
            }
        }


        // --- Fonctions de g√©n√©ration d'exercices sp√©cifiques ---

        /**
         * Partie 1 : √âvolution Simple (VD, VA, ou t)
         * @param {number} type 1: VA, 2: VD, 3: t
         */
        function genererExercicePart1(type) { // PARAM√àTRE TYPE AJOUT√â
            const targetDivId = 'exercices-part1';
            
            const VD = arrondir(getRandomArbitrary(50, 200), 2);
            const t_percent = arrondir(getRandomArbitrary(-40, 60), 2);
            const C = arrondir(1 + t_percent / 100, 4);
            const VA = arrondir(VD * C, 2);

            let enonce, reponse, correction;

            switch (type) {
                case 1: // Calculer VA
                    enonce = `Un article co√ªte initialement \\( ${VD} \\) euros. Son prix augmente de \\( ${t_percent}\\% \\). Quel est son prix final ?`;
                    if (t_percent < 0) {
                        enonce = `Un article co√ªte initialement \\( ${VD} \\) euros. Son prix diminue de \\( ${Math.abs(t_percent)}\\% \\). Quel est son prix final ?`;
                    }
                    reponse = `Le prix final est de \\( ${VA} \\) euros.`;
                    correction = `
                        <h4>Correction d√©taill√©e :</h4>
                        <p>Coefficient multiplicateur : \\( C = 1 + \\dfrac{${t_percent}}{100} = ${C} \\)</p>
                        <p>Prix final : \\( V_A = V_D \\times C = ${VD} \\times ${C} = ${VA} \\) euros.</p>
                    `;
                    break;

                case 2: // Calculer VD
                    enonce = `Apr√®s une augmentation de \\( ${t_percent}\\% \\), le prix d'un produit atteint \\( ${VA} \\) euros. Quel √©tait son prix initial ?`;
                    if (t_percent < 0) {
                        enonce = `Apr√®s une diminution de \\( ${Math.abs(t_percent)}\\% \\), le prix d'un produit atteint \\( ${VA} \\) euros. Quel √©tait son prix initial ?`;
                    }
                    reponse = `Le prix initial √©tait de \\( ${VD} \\) euros.`;
                    correction = `
                        <h4>Correction d√©taill√©e :</h4>
                        <p>Coefficient multiplicateur : \\( C = 1 + \\dfrac{${t_percent}}{100} = ${C} \\)</p>
                        <p>Prix initial : \\( V_D = \\dfrac{V_A}{C} = \\dfrac{${VA}}{${C}} = ${VD} \\) euros.</p>
                    `;
                    break;
                
                case 3: // Calculer t (Taux)
                    enonce = `Le prix d'un objet passe de \\( ${VD} \\) euros √† \\( ${VA} \\) euros. Calculer le taux d'√©volution de ce prix (en pourcentage arrondi √† 2 d√©cimales).`;
                    reponse = `Le taux d'√©volution est de \\( ${t_percent}\\% \\).`;
                    correction = `
                        <h4>Correction d√©taill√©e :</h4>
                        <p>Le taux d'√©volution \\( t \\) est donn√© par la formule :</p>
                        \\[
                        t = \\dfrac{V_A - V_D}{V_D}
                        \\]
                        \\[
                        t = \\dfrac{${VA} - ${VD}}{${VD}} = ${arrondir(t_percent/100, 4)}
                        \\]
                        <p>Le taux en pourcentage est : \\( ${arrondir(t_percent/100, 4)} \\times 100 = ${t_percent}\\% \\)</p>
                    `;
                    break;
            }
            creerExercice(targetDivId, enonce, reponse, correction);
        }

        /**
         * Partie 2 : √âvolutions Successives (VD, VA, t_global, ou un des taux individuels)
         * @param {number} type 1: VA, 2: VD, 3: t_global, 4: t_individuel
         */
        function genererExercicePart2(type) { // PARAM√àTRE TYPE AJOUT√â
            const targetDivId = 'exercices-part2';
            
            const VD = arrondir(getRandomArbitrary(100, 500), 0);
            const nombreEvolutions = getRandomInt(2, 4);
            const evolutions = [];
            for (let i = 0; i < nombreEvolutions; i++) {
                let taux = arrondir(getRandomArbitrary(-20, 40), 2);
                while (taux === -100) { 
                    taux = arrondir(getRandomArbitrary(-20, 40), 2);
                }
                evolutions.push(taux);
            }

            const coeffMultiplicateurs = evolutions.map(e => 1 + e / 100);
            const coeffGlobal = coeffMultiplicateurs.reduce((acc, current) => acc * current, 1);
            const VA = arrondir(VD * coeffGlobal, 2);
            const t_global = arrondir((coeffGlobal - 1) * 100, 2);

            let evolutionsAffichees = evolutions.map(e => `\\( ${e}\\% \\)`).join(', ');

            let enonce, reponse, correction;

            switch (type) {
                case 1: // Calculer VA
                    enonce = `Une valeur de d√©part de \\( ${VD} \\) subit des √©volutions successives de ${evolutionsAffichees}. Quelle est la valeur d'arriv√©e ?`;
                    reponse = `La valeur d'arriv√©e est de \\( ${VA} \\).`;
                    correction = `
                        <h4>Correction d√©taill√©e :</h4>
                        <p>Les coefficients multiplicateurs sont :</p>
                        ${evolutions.map(e => `\\( C_{${evolutions.indexOf(e)+1}} = 1 + \\dfrac{${e}}{100} = ${arrondir(1 + e/100, 4)} \\)`).join('<br>')}
                        <p>Coefficient multiplicateur global :</p>
                        \\[
                        C_{global} = ${coeffMultiplicateurs.map(c => arrondir(c, 4)).join(' \\times ')} = ${arrondir(coeffGlobal, 4)}
                        \\]
                        <p>Valeur d'arriv√©e : \\( V_A = ${VD} \\times ${arrondir(coeffGlobal, 4)} = ${VA} \\)</p>
                    `;
                    break;

                case 2: // Calculer VD
                    enonce = `Une valeur a subi des √©volutions successives de ${evolutionsAffichees}. La valeur finale est de \\( ${VA} \\) euros. Quelle √©tait la valeur de d√©part ?`;
                    reponse = `La valeur de d√©part √©tait de \\( ${VD} \\) euros.`;
                    correction = `
                        <h4>Correction d√©taill√©e :</h4>
                        <p>Coefficient multiplicateur global :</p>
                        \\[
                        C_{global} = ${coeffMultiplicateurs.map(c => arrondir(c, 4)).join(' \\times ')} = ${arrondir(coeffGlobal, 4)}
                        \\]
                        <p>Valeur de d√©part : \\( V_D = \\dfrac{V_A}{C_{global}} = \\dfrac{${VA}}{${arrondir(coeffGlobal, 4)}} = ${VD} \\) euros.</p>
                    `;
                    break;
                
                case 3: // Calculer t_global
                    enonce = `Calculer le taux d'√©volution global de ${nombreEvolutions} √©volutions successives de ${evolutionsAffichees}. (Arrondir √† 2 d√©cimales).`;
                    reponse = `Le taux d'√©volution global est de \\( ${t_global}\\% \\).`;
                    correction = `
                        <h4>Correction d√©taill√©e :</h4>
                        <p>Coefficient multiplicateur global :</p>
                        \\[
                        C_{global} = ${coeffMultiplicateurs.map(c => arrondir(c, 4)).join(' \\times ')} = ${arrondir(coeffGlobal, 4)}
                        \\]
                        <p>Taux global : \\( t_{global} = (C_{global} - 1) \\times 100 = (${arrondir(coeffGlobal, 4)} - 1) \\times 100 = ${t_global}\\% \\)</p>
                    `;
                    break;

                case 4: // Calculer un des taux
                    const index_inconnu = getRandomInt(0, nombreEvolutions - 1);
                    const t_inconnu = evolutions[index_inconnu];
                    
                    // Calculer le produit des coefficients connus
                    let produit_coeffs_connus = 1;
                    for (let i = 0; i < nombreEvolutions; i++) {
                        if (i !== index_inconnu) {
                            produit_coeffs_connus *= coeffMultiplicateurs[i];
                        }
                    }
                    produit_coeffs_connus = arrondir(produit_coeffs_connus, 4);

                    // Formuler l'√©nonc√©
                    let evolutions_enonce = [];
                    for (let i = 0; i < nombreEvolutions; i++) {
                        if (i === index_inconnu) {
                            evolutions_enonce.push(`un taux inconnu \\( t \\)`);
                        } else {
                            evolutions_enonce.push(`\\( ${evolutions[i]}\\% \\)`);
                        }
                    }
                    const t_global_arrondi = arrondir(t_global, 2);
                    enonce = `Une valeur a subi ${nombreEvolutions} √©volutions successives : ${evolutions_enonce.join(', ')}. Le taux d'√©volution global est de \\( ${t_global_arrondi}\\% \\). Calculer le taux inconnu \\( t \\) (en pourcentage arrondi √† 2 d√©cimales).`;
                    
                    reponse = `Le taux inconnu est \\( ${t_inconnu}\\% \\).`;
                    
                    // Correction
                    const C_global_arrondi = arrondir(coeffGlobal, 4);
                    const C_inconnu_calcul = arrondir(C_global_arrondi / produit_coeffs_connus, 4);
                    const t_inconnu_calcul = arrondir((C_inconnu_calcul - 1) * 100, 2);

                    correction = `
                        <h4>Correction d√©taill√©e :</h4>
                        <p>1. Calcul du coefficient multiplicateur global \\( C_{global} \\) :</p>
                        \\[
                        C_{global} = 1 + \\dfrac{t_{global}}{100} = 1 + \\dfrac{${t_global_arrondi}}{100} = ${C_global_arrondi}
                        \\]
                        <p>2. Le coefficient multiplicateur global est le produit des coefficients individuels. Le produit des coefficients connus est :</p>
                        \\[
                        C_{connus} = ${produit_coeffs_connus}
                        \\]
                        <p>3. Calcul du coefficient multiplicateur inconnu \\( C \\) :</p>
                        \\[
                        C = \\dfrac{C_{global}}{C_{connus}} = \\dfrac{${C_global_arrondi}}{${produit_coeffs_connus}} = ${C_inconnu_calcul}
                        \\]
                        <p>4. Calcul du taux inconnu \\( t \\) :</p>
                        \\[
                        t = (C - 1) \\times 100 = (${C_inconnu_calcul} - 1) \\times 100 = ${t_inconnu_calcul}\\%
                        \\]
                    `;
                    break;
            }
            creerExercice(targetDivId, enonce, reponse, correction);
        }

        /**
         * Partie 3 : Taux d'√âvolution Moyen (t_moyen, VD, VA, n, ou Vk)
         * @param {number} type 1: VA, 2: VD, 3: t_moyen (√† partir des taux successifs), 4: n (nombre de p√©riodes), 5: Vk (Valeur interm√©diaire)
         */
        function genererExercicePart3(type) { // PARAM√àTRE TYPE AJOUT√â
            const targetDivId = 'exercices-part3';
            
            let enonce, reponse, correction;

            if (type === 3) {
                // --- SC√âNARIO 1: Calcul du Taux Moyen √† partir des taux successifs (t_moyen) ---
                const nombreEvolutions = getRandomInt(3, 5); 
                const evolutions = [];
                for (let i = 0; i < nombreEvolutions; i++) {
                    evolutions.push(arrondir(getRandomArbitrary(-10, 25), 2));
                }

                const coeffMultiplicateurs = evolutions.map(e => 1 + e / 100);
                const coeffGlobal = coeffMultiplicateurs.reduce((acc, current) => acc * current, 1);
                
                const coeffMoyen = Math.pow(coeffGlobal, 1 / nombreEvolutions);
                const t_moyen = arrondir((coeffMoyen - 1) * 100, 2);

                let evolutionsAffichees = evolutions.map(e => `\\( ${e}\\% \\)`).join(', ');

                enonce = `Entre l'ann√©e 1 et l'ann√©e ${nombreEvolutions + 1}, une valeur a subi les √©volutions annuelles suivantes : ${evolutionsAffichees}. Quel est le taux d'√©volution annuel moyen ? (Arrondir √† 2 d√©cimales).`;
                reponse = `Le taux d'√©volution annuel moyen est de \\( ${t_moyen}\\% \\).`;
                
                correction = `
                    <h4>Correction d√©taill√©e :</h4>
                    <p>1. Calcul du coefficient multiplicateur global :</p>
                    \\[
                    C_{global} = ${coeffMultiplicateurs.map(c => arrondir(c, 4)).join(' \\times ')} = ${arrondir(coeffGlobal, 4)}
                    \\]
                    <p>2. Calcul du coefficient multiplicateur moyen (pour \\( n=${nombreEvolutions} \\) p√©riodes) :</p>
                    \\[
                    C_{moyen} = (C_{global})^{\\dfrac{1}{n}} = (${arrondir(coeffGlobal, 4)})^{\\dfrac{1}{${nombreEvolutions}}} = ${arrondir(coeffMoyen, 4)}
                    \\]
                    <p>3. Calcul du taux moyen :</p>
                    \\[
                    t_{moyen} = (C_{moyen} - 1) \\times 100 = (${arrondir(coeffMoyen, 4)} - 1) \\times 100 = ${t_moyen}\\%
                    \\]
                `;

            } else {
                // --- SC√âNARIO 2: Calcul bas√© sur le Taux Moyen DONN√â (pour VD, VA, n, ou Vk) ---
                const n = getRandomInt(3, 8); // Nombre de p√©riodes total
                const t_moyen_percent = arrondir(getRandomArbitrary(-5, 15), 2); // Taux moyen donn√©
                const VD = arrondir(getRandomArbitrary(200, 1000), 2); 
                
                const C_moyen = arrondir(1 + t_moyen_percent / 100, 4);
                const C_global = arrondir(Math.pow(C_moyen, n), 6);
                const VA = arrondir(VD * C_global, 2);

                const C_moyen_aff = arrondir(C_moyen, 4);

                switch (type) {
                    case 1: // Calculer VA
                        enonce = `Une valeur de d√©part de \\( ${VD} \\) euros subit une √©volution annuelle moyenne de \\( ${t_moyen_percent}\\% \\) pendant \\( ${n} \\) ann√©es. Quelle est la valeur d'arriv√©e ?`;
                        reponse = `La valeur d'arriv√©e est de \\( ${VA} \\) euros.`;
                        correction = `
                            <h4>Correction d√©taill√©e :</h4>
                            <p>1. Coefficient multiplicateur annuel moyen : \\( C_{moyen} = 1 + \\dfrac{${t_moyen_percent}}{100} = ${C_moyen_aff} \\)</p>
                            <p>2. Coefficient multiplicateur global : \\( C_{global} = (C_{moyen})^n = (${C_moyen_aff})^{${n}} = ${arrondir(C_global, 4)} \\)</p>
                            <p>3. Valeur d'arriv√©e : \\( V_A = V_D \\times C_{global} = ${VD} \\times ${arrondir(C_global, 4)} = ${VA} \\) euros.</p>
                        `;
                        break;

                    case 2: // Calculer VD
                        enonce = `Une valeur a atteint \\( ${VA} \\) euros apr√®s \\( ${n} \\) ann√©es d'√©volution annuelle moyenne de \\( ${t_moyen_percent}\\% \\). Quelle √©tait la valeur de d√©part ?`;
                        reponse = `La valeur de d√©part √©tait de \\( ${VD} \\) euros.`;
                        correction = `
                            <h4>Correction d√©taill√©e :</h4>
                            <p>1. Coefficient multiplicateur annuel moyen : \\( C_{moyen} = 1 + \\dfrac{${t_moyen_percent}}{100} = ${C_moyen_aff} \\)</p>
                            <p>2. Coefficient multiplicateur global : \\( C_{global} = (C_{moyen})^n = (${C_moyen_aff})^{${n}} = ${arrondir(C_global, 4)} \\)</p>
                            <p>3. Valeur de d√©part : \\( V_D = \\dfrac{V_A}{C_{global}} = \\dfrac{${VA}}{${arrondir(C_global, 4)}} = ${VD} \\) euros.</p>
                        `;
                        break;
                    
                    case 4: // Calculer n (Nombre de p√©riodes)
                        // Pour le calcul de n, on utilise le n exact avant l'arrondi.
                        const C_global_exact = VA / VD; // On utilise les valeurs g√©n√©r√©es pour avoir un n entier
                        const log_C_global = Math.log(C_global_exact);
                        const log_C_moyen = Math.log(C_moyen);
                        const n_calcul = arrondir(log_C_global / log_C_moyen, 0); // n est un entier, arrondi √† l'entier le plus proche

                        enonce = `Une valeur passe de \\( ${VD} \\) euros √† \\( ${VA} \\) euros. Si cette √©volution s'est faite √† un taux annuel moyen de \\( ${t_moyen_percent}\\% \\), combien d'ann√©es se sont √©coul√©es ? (Donner le nombre entier d'ann√©es).`;
                        reponse = `Il s'est √©coul√© \\( ${n_calcul} \\) ann√©es.`;
                        correction = `
                            <h4>Correction d√©taill√©e :</h4>
                            <p>1. Coefficient multiplicateur annuel moyen : \\( C_{moyen} = 1 + \\dfrac{${t_moyen_percent}}{100} = ${C_moyen_aff} \\)</p>
                            <p>2. Coefficient multiplicateur global : \\( C_{global} = \\dfrac{V_A}{V_D} = \\dfrac{${VA}}{${VD}} = ${arrondir(C_global_exact, 4)} \\)</p>
                            <p>3. R√©solution de l'√©quation \\( (C_{moyen})^n = C_{global} \\) en utilisant les logarithmes n√©p√©riens :</p>
                            \\[
                            n = \\dfrac{\\ln(C_{global})}{\\ln(C_{moyen})} = \\dfrac{\\ln(${arrondir(C_global_exact, 4)})}{\\ln(${C_moyen_aff})} \\approx ${n_calcul}
                            \\]
                            <p>Il s'est √©coul√© \\( ${n_calcul} \\) ann√©es.</p>
                        `;
                        break;
                    
                    case 5: // Calculer Vk (Valeur Interm√©diaire)
                        const k = getRandomInt(1, n - 1); // Sub-period is less than total n
                        const C_inter = arrondir(Math.pow(C_moyen, k), 6);
                        const V_inter = arrondir(VD * C_inter, 2);

                        enonce = `Une valeur de d√©part de \\( ${VD} \\) euros subit une √©volution annuelle moyenne de \\( ${t_moyen_percent}\\% \\) pendant \\( ${n} \\) ann√©es. Quelle est la valeur de cette propri√©t√© apr√®s \\( ${k} \\) ann√©es ?`;
                        reponse = `La valeur apr√®s \\( ${k} \\) ann√©es est de \\( ${V_inter} \\) euros.`;
                        correction = `
                            <h4>Correction d√©taill√©e :</h4>
                            <p>1. Coefficient multiplicateur annuel moyen : \\( C_{moyen} = 1 + \\dfrac{${t_moyen_percent}}{100} = ${C_moyen_aff} \\)</p>
                            <p>2. Coefficient multiplicateur pour \\( ${k} \\) ann√©es : \\( C_{k} = (C_{moyen})^k = (${C_moyen_aff})^{${k}} = ${arrondir(C_inter, 4)} \\)</p>
                            <p>3. Valeur interm√©diaire : \\( V_k = V_D \\times C_{k} = ${VD} \\times ${arrondir(C_inter, 4)} = ${V_inter} \\) euros.</p>
                        `;
                        break;

                    default:
                        // Fallback
                        return;
                }
            }
            creerExercice(targetDivId, enonce, reponse, correction);
        }
        
        // --- Fonction de g√©n√©ration al√©atoire globale ---
        function genererExerciceAleatoire() {
            const part = getRandomInt(1, 3);
            document.getElementById('exercices-generaux').innerHTML = ''; // Nettoyer l'ancienne zone
            
            let type;
            if (part === 1) {
                type = getRandomInt(1, 3);
                genererExercicePart1(type);
            } else if (part === 2) {
                type = getRandomInt(1, 4);
                genererExercicePart2(type);
            } else { // part === 3
                type = getRandomInt(1, 5);
                genererExercicePart3(type);
            }

            // D√©placer l'exercice g√©n√©r√© dans la zone d'exercices g√©n√©raux
            const sourceDivId = 'exercices-part' + part;
            const sourceDiv = document.getElementById(sourceDivId);
            const exercice = sourceDiv.querySelector('.exercice');
            
            if (exercice) {
                // Cr√©er une copie ou d√©placer (d√©placement ici)
                document.getElementById('exercices-generaux').appendChild(exercice);
                document.getElementById('titre-general').style.display = 'block';
                sourceDiv.innerHTML = ''; // Nettoyer la zone source
            }
        }
    </script>
</body>
</html>
