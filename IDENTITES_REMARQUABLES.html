<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercices sur les Identités Remarquables</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            padding: 20px;
            text-align: center;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007bff;
            margin-bottom: 30px;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #218838;
        }
        .exercice {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: left;
            background-color: #e9ecef;
        }
        .math-expr {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .type-header {
            font-weight: bold;
            color: #0056b3;
            margin-top: 10px;
        }
        .hint-level {
            margin-top: 8px !important;
            padding: 8px;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 3px;
            font-size: 0.95em;
        }
        .solution {
            padding: 10px;
            border: 1px dashed #aaa;
            background-color: #ffe8d6;
            margin-top: 15px;
            border-radius: 5px;
        }
        .hint-button {
            background-color: #ffc107;
            color: #333;
            padding: 6px 12px;
            font-size: 0.9em;
            margin-top: 10px;
            border-radius: 4px;
        }
        .hint-button:hover {
            background-color: #e0a800;
        }
    </style>
    
    
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
</head>
<body>

    <div class="container">
        <h1>Générateur d'Exercices : Identités Remarquables</h1>
        <p>Coefficients aléatoires compris entre <span style="font-weight: bold; color: red;">2 et 20</span>. Un seul exercice à la fois avec aides graduées.</p>
        <button onclick="generateExercises()">Générer un Nouvel Exercice</button>
        <div id="exercices-output">
            </div>
    </div>

    <script>
        // Fonction utilitaire pour obtenir un entier aléatoire entre min et max (inclus)
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Renvoie l'expression LaTeX pour un terme ax^n, gérant a=1 ou a=0
        function getLatexTerm(a, x, n = 1) {
            const abs_a = Math.abs(a);
            
            // Partie du coefficient
            let coeff_part;
            if (n === 0) {
                coeff_part = abs_a;
            } else if (abs_a === 1) {
                coeff_part = '';
            } else {
                coeff_part = abs_a;
            }
            
            // Partie de la variable
            let var_part;
            if (n === 0) {
                var_part = '';
            } else if (n === 1) {
                var_part = x;
            } else { // n >= 2
                var_part = x + '^{' + n + '}';
            }
            
            return coeff_part + var_part;
        }

        // Renvoie les aides graduées en fonction de l'opération et du type d'identité
        function getGraduatedHints(a, b, type, operation) {
            let hints = [];
            const A_term = getLatexTerm(a, 'x');
            const A2_term = getLatexTerm(a * a, 'x', 2);
            const B_term = b;
            const B2_term = b * b;
            
            // Utilisation de double antislash (\\) pour l'échappement en JS/LaTeX
            const A_sqrt_latex = `\\sqrt{${A2_term}}`; 
            const B_sqrt_latex = `\\sqrt{${B2_term}}`; 

            if (operation === 'Expansion') {
                // Hints pour le Développement
                switch (type) {
                    case 1: // (A+B)²
                        hints.push("Identifiez la forme : c'est un développement de la forme $$(A+B)^2$$");
                        hints.push("Formule à appliquer : $$(A+B)^2 = A^2 + 2AB + B^2$$");
                        // Correction: Mise de toute l'application entre $$ pour le rendu
                        const expApp1 = `Application : Identifiez $$A = ${A_term}$$ et $$B = ${B_term}$$ Le développement est $$\\left( ${A_term} \\right)^2 + 2\\left(${A_term}\\right)\\left(${B_term}\\right) + \\left(${B_term}\\right)^2$$`;
                        hints.push(expApp1);
                        break;
                    case 2: // (A-B)²
                        hints.push("Identifiez la forme : c'est un développement de la forme $$(A-B)^2$$");
                        hints.push("Formule à appliquer : $$(A-B)^2 = A^2 - 2AB + B^2$$");
                        const expApp2 = `Application : Identifiez $$A = ${A_term}$$ et $$B = ${B_term}$$ Le développement est $$\\left( ${A_term} \\right)^2 - 2\\left(${A_term}\\right)\\left(${B_term}\\right) + \\left(${B_term}\\right)^2$$`;
                        hints.push(expApp2);
                        break;
                    case 3: // (A+B)(A-B)
                        hints.push("Identifiez la forme : c'est un développement de la forme $$(A+B)(A-B)$$");
                        hints.push("Formule à appliquer : $$(A+B)(A-B) = A^2 - B^2$$");
                        const expApp3 = `Application : Identifiez $$A = ${A_term}$$ et $$B = ${B_term}$$ Le développement est $$\\left( ${A_term} \\right)^2 - \\left(${B_term}\\right)^2$$`;
                        hints.push(expApp3);
                        break;
                }
            } else { 
                // Hints pour la Factorisation
                switch (type) {
                    case 1: // A² + 2AB + B²
                        hints.push("Identifiez la forme : c'est une factorisation de la forme $$A^2 + 2AB + B^2$$");
                        hints.push("Formule à appliquer : $$A^2 + 2AB + B^2 = (A+B)^2$$");
                        // Correction: Les termes $A$ et $B$ sont encadrés par $$ pour une interprétation correcte
                        const factApp1 = `Application : Trouvez \\(A\\) et \\(B\\) : $$A = ${A_sqrt_latex} = ${A_term}$$ et $$B = ${B_sqrt_latex} = ${B_term}$$`;
                        hints.push(factApp1);
                        break;
                    case 2: // A² - 2AB + B²
                        hints.push("Identifiez la forme : c'est une factorisation de la forme $$A^2 - 2AB + B^2$$");
                        hints.push("Formule à appliquer : $$A^2 - 2AB + B^2 = (A-B)^2$$");
                        const factApp2 = `Application : Trouvez \\(A\\) et \\(B\\) : $$A = ${A_sqrt_latex} = ${A_term}$$ et $$B = ${B_sqrt_latex} = ${B_term}$$`;
                        hints.push(factApp2);
                        break;
                    case 3: // A² - B²
                        hints.push("Identifiez la forme : c'est une factorisation de la forme $$A^2 - B^2$$");
                        hints.push("Formule à appliquer : $$A^2 - B^2 = (A-B)(A+B)$$");
                        const factApp3 = `Application : Trouvez \\(A\\) et \\(B\\) : $$A = ${A_sqrt_latex} = ${A_term}$$ et $$B = ${B_sqrt_latex} = ${B_term}$$`;
                        hints.push(factApp3);
                        break;
                }
            }
            return hints;
        }

        // Génère un exercice de développement
        function generateExpansionExercise(a, b, type) {
            const A_term = getLatexTerm(a, 'x');
            const B_term = b;
            const A2_term = getLatexTerm(a * a, 'x', 2);
            const B2_term = b * b;
            const twoAB_term = getLatexTerm(2 * a * b, 'x');
            let latex_question = '';
            let latex_answer = '';

            switch (type) {
                case 1: 
                    latex_question = `(${A_term} + ${B_term})^2`;
                    latex_answer = `${A2_term} + ${twoAB_term} + ${B2_term}`;
                    break;
                case 2: 
                    latex_question = `(${A_term} - ${B_term})^2`;
                    latex_answer = `${A2_term} - ${twoAB_term} + ${B2_term}`;
                    break;
                case 3: 
                    latex_question = `(${A_term} + ${B_term})(${A_term} - ${B_term})`;
                    latex_answer = `${A2_term} - ${B2_term}`;
                    break;
            }

            return {
                type: 'Développement',
                question: `$$${latex_question}$$`,
                answer: `$$${latex_answer}$$`,
                hint: `Identité n°${type}`
            };
        }

        // Génère un exercice de factorisation
        function generateFactorizationExercise(a, b, type) {
            const A_term = getLatexTerm(a, 'x');
            const B_term = b;
            const A2_term = getLatexTerm(a * a, 'x', 2);
            const B2_term = b * b;
            const twoAB_term = getLatexTerm(2 * a * b, 'x');
            let latex_question = '';
            let latex_answer = '';
            
            switch (type) {
                case 1: 
                    latex_question = `${A2_term} + ${twoAB_term} + ${B2_term}`;
                    latex_answer = `(${A_term} + ${B_term})^2`;
                    break;
                case 2: 
                    latex_question = `${A2_term} - ${twoAB_term} + ${B2_term}`;
                    latex_answer = `(${A_term} - ${B_term})^2`;
                    break;
                case 3: 
                    latex_question = `${A2_term} - ${B2_term}`;
                    latex_answer = `(${A_term} + ${B_term})(${A_term} - ${B_term})`;
                    break;
            }

            return {
                type: 'Factorisation',
                question: `$$${latex_question}$$`,
                answer: `$$${latex_answer}$$`,
                hint: `Identité n°${type}`
            };
        }

        // Fonction principale pour générer un exercice
        function generateExercises() {
            const outputDiv = document.getElementById('exercices-output');
            outputDiv.innerHTML = ''; 

            // Coefficients et type d'identité
            // MODIFICATION ICI : Coefficients entre 2 et 20 inclus
            const a = getRandomInt(2, 20); 
            const b = getRandomInt(2, 20);
            const type = getRandomInt(1, 3); 

            const expansionEx = generateExpansionExercise(a, b, type);
            const factorizationEx = generateFactorizationExercise(a, b, type);

            // Obtenir les aides
            const expHints = getGraduatedHints(a, b, type, 'Expansion');
            const factHints = getGraduatedHints(a, b, type, 'Factorization');
            
            // Fonction pour générer l'HTML des aides
            const renderHints = (hints, sectionId) => {
                let hintHtml = '';
                hints.forEach((hint, index) => {
                    // Chaque aide est cachée au départ
                    hintHtml += `<div id="${sectionId}_hint_${index + 1}" class="hint-level" style="display:none;">
                                        <strong>Aide ${index + 1}</strong> : ${hint}
                                       </div>`;
                });
                return hintHtml;
            };

            const exerciseHTML = `
                <div class="exercice" id="current-exercise">
                    <h2>Exercice Unique</h2>
                    <p>Développez et Factorisez en utilisant l'**Identité n°${type}**.</p>
                    
                    <hr>
                    <div id="section-expansion">
                        <div class="type-header">A. Développement : ${expansionEx.hint}</div>
                        <div class="math-expr">${expansionEx.question}</div>
                        
                        <button class="hint-button" onclick="showNextHint('expansion', ${expHints.length})">Afficher l'Aide Suivante (Développement)</button>
                        <div class="hints-container" data-current-hint="0" data-section="expansion">
                            ${renderHints(expHints, 'expansion')}
                        </div>
                        
                        <div class="solution expansion-solution" style="display:none;">
                            <strong>Solution Développement</strong> : ${expansionEx.answer}
                        </div>
                    </div>
                    
                    <hr>
                    <div id="section-factorization">
                        <div class="type-header">B. Factorisation : ${factorizationEx.hint}</div>
                        <div class="math-expr">${factorizationEx.question}</div>
                        
                        <button class="hint-button" onclick="showNextHint('factorization', ${factHints.length})">Afficher l'Aide Suivante (Factorisation)</button>
                        <div class="hints-container" data-current-hint="0" data-section="factorization">
                            ${renderHints(factHints, 'factorization')}
                        </div>
                        
                        <div class="solution factorization-solution" style="display:none;">
                            <strong>Solution Factorisation</strong> : ${factorizationEx.answer}
                        </div>
                    </div>
                    <hr>
                    
                    <button onclick="toggleAllSolutions(this)">Afficher/Masquer Toutes les Solutions</button>
                </div>
            `;
            outputDiv.innerHTML = exerciseHTML;

            // *** APPEL À MATHJAX POUR RENDRE LES EXPRESSIONS INITIALES ***
             if (typeof MathJax !== 'undefined') {
                 MathJax.typesetPromise([outputDiv]); 
             } 
        }

        // Affiche la prochaine aide disponible (fonction pour l'aide graduée)
        function showNextHint(sectionName, totalHints) {
            const hintsContainer = document.querySelector(`.hints-container[data-section="${sectionName}"]`);
            const currentHintIndex = parseInt(hintsContainer.dataset.currentHint);
            
            if (currentHintIndex < totalHints) {
                const nextHintId = `${sectionName}_hint_${currentHintIndex + 1}`;
                const nextHintElement = document.getElementById(nextHintId);
                
                if (nextHintElement) {
                    nextHintElement.style.display = 'block';
                    hintsContainer.dataset.currentHint = currentHintIndex + 1;
                }
            }

            // Masquer le bouton si toutes les aides sont affichées
            if (currentHintIndex + 1 >= totalHints) {
                const button = document.querySelector(`#section-${sectionName} .hint-button`);
                if (button) {
                     button.style.display = 'none';
                }
            }
             // Relancer MathJax sur la section pour rendre les éventuelles formules LaTeX dans l'aide
             if (typeof MathJax !== 'undefined') {
                 // On ne demande le rendu que de l'élément d'aide qui vient d'apparaître pour optimiser
                 MathJax.typesetPromise([document.getElementById(nextHintId)]); 
             } 
        }

        // Affiche/Masque toutes les solutions
        function toggleAllSolutions(button) {
            const solutions = button.parentNode.querySelectorAll('.solution');
            solutions.forEach(sol => {
                const isHidden = sol.style.display === 'none' || sol.style.display === '';
                sol.style.display = isHidden ? 'block' : 'none';
            });
             // Si on vient d'afficher les solutions, on demande à MathJax de les rendre
             if (solutions[0].style.display === 'block' && typeof MathJax !== 'undefined') {
                 MathJax.typesetPromise(solutions); 
             }
        }

        // Générer le premier exercice au chargement initial de la page
        document.addEventListener('DOMContentLoaded', () => {
            generateExercises(); 
        });
    </script>

</body>
</html>